# Defining and running multi-container Docker application
version: '3'

services:  
   # mariadb  
  mariadb:
    build: ./requirements/mariadb
    container_name: mariadb
    command: bash script.sh
    env_file:  
      - ./.env
    volumes:
      - mariadb-v:/var/lib/mysql
    restart: always
    networks:
      - inception

  # Nginx Service
  nginx:
    depends_on: 
      - wordpress
    build: ./requirements/nginx
    container_name: nginx
    command: nginx -g "daemon off;"
    ports:
      - 443:443 
    links:
      - wordpress
    volumes:
      - wordpress-v:/var/www/website 
    restart: always
    networks: 
      - inception

  # wordpress  
  wordpress:
    depends_on:
      - mariadb
    build: ./requirements/wordpress
    container_name: wordpress
    volumes:
      - wordpress-v:/var/www/website
    links:
      - mariadb
    restart: always
    networks:
      - inception
  

networks:
  inception:
    driver: bridge    

volumes:
  mariadb-v:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: /home/xuwang/data/mariadb-v
  wordpress-v:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: /home/xuwang/data/wordpress-v

  
